<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Pierc-postgresql by p2j</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Pierc-postgresql</h1>
          <h2>A python bot that logs IRC channels, and a PHP/JS interface for browsing said logs, using PostgreSQL as the database backend.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/p2j/pierc-postgresql/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/p2j/pierc-postgresql/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/p2j/pierc-postgresql" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h3>
<a id="what" class="anchor" href="#what" aria-hidden="true"><span class="octicon octicon-link"></span></a>What?</h3>

<p>Pierc is an IRC Logbot, paired with a web application for browsing and searching through logs.  The project was adapted from classam's pierc, available at <a href="https://github.com/classam/pierc">https://github.com/classam/pierc</a> . The original work used MySQL, and I wanted to use PostgreSQL. hence, pierc-postgresql! </p>

<p>It is written in Python (for the logger), and PHP &amp; JavaScript (for the client).</p>

<h3>
<a id="why" class="anchor" href="#why" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why?</h3>

<p>The ability to review past IRC communication is a feature that is not readily available as a part of many IRC clients. The easiest way to save chat history is to scrape it with a bot. This tool does just that! Additionally, for convenience, the data is saved in a PostgreSQL database. </p>

<p>The included viewing client design was done by Curtis Lassam. I simply modified it to work with my bot code focused on PostgreSQL. </p>

<p>For your bot-controlling pleasure, there are also the init_script.sh and IRCbot.service files for integration with systemd. </p>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<h4>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h4>

<p>Pierc-postgresql requires the following to be pre-installed...</p>

<ul>
<li>a web server that can handle PHP and PostgreSQL (Apache with php and php-pgsql was used by the author)</li>
<li>Python (duh!) and python-psycopg2, which is the python wrapper for interfacing with the database</li>
<li>An internet connection, registered IRC bot (username, password), and some channel that you want to log!</li>
</ul>

<h4>
<a id="1-create-the-database" class="anchor" href="#1-create-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Create the database</h4>

<p>PostgreSQL has a nifty command-line tool called 'createdb' for creating a database. You have to do this as a database-admin user, specified with the -U flag. -W forces the password prompt. dbname is the name of the database you want to create.</p>

<pre><code>$ createdb -U adminusername -W dbname
</code></pre>

<p>If you want to create a IRC bot database user, now would be the time to do so. Be sure to grant it create, temp, and connect privileges. </p>

<p>Note that if the database will be on a remote server, it will have to be preconfigured for remote access.</p>

<h4>
<a id="2-populate-the-database" class="anchor" href="#2-populate-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Populate the Database</h4>

<p>The bot folder contains everything needed to create the main database table and to run the bot. You will need to copy the postgresql_config.txt.example and irc_config.txt.example files into example-less versions. Then, fill in the proper data for each file (irc_config holds the IRC network info and bot login info, while postgresql-config holds the info for the bot to access the database). Be sure to change the file permissions on these to 700 to ensure that only your bot user can read their contents. </p>

<p>Once the config files are set up, simply run</p>

<pre><code>$ python pierc_db.py
</code></pre>

<p>to make the database table.</p>

<h3>
<a id="3-run-the-irc-bot" class="anchor" href="#3-run-the-irc-bot" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Run the IRC Bot</h3>

<p>Once the config files and database are set up, simply run</p>

<pre><code>$ python pierc.py
</code></pre>

<p>to start the bot! It will connect to your preferred IRC network and channel and start saving messages to the database. </p>

<p>If you are running pierc-postgresql on a remote server (which is highly recommended), you should probably pipe the script output to a file or /dev/null (since the output is simply the IRC chat log).</p>

<h3>
<a id="4-installing-the-irc-bot-into-systemd" class="anchor" href="#4-installing-the-irc-bot-into-systemd" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Installing the IRC Bot into systemd</h3>

<p>If you use Linux that is based on systemd, the included IRCbot.service and init_script.sh files can be used to set up the bot to run as a service. This means that it can be configured to run on system startup, automatically restarted if the bot quits, and managed using systemctl. </p>

<p>To allow for this, you need to copy the .service file into /usr/lib/systemd/system/ (as root or using sudo)</p>

<pre><code># cp /path/to/IRCbot.service /usr/lib/systemd/system/IRCbot.service
</code></pre>

<p>Then, you can enable and start the service with systemctl</p>

<pre><code># systemctl enable IRCbot
# systemctl start IRCbot
</code></pre>

<p>That's it! Your bot will now work as a service. </p>

<h4>
<a id="3-set-up-the-web-client" class="anchor" href="#3-set-up-the-web-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Set Up the Web Client</h4>

<p>The web folder has everything you need to access the IRC logs via a webpage. Simply copy the web folder's contents to a directory accessible by your web server (probably /var/www/IRCbot). Then, you need to do some configuration. Copy the contents of config.php.example to config.php and change the settings accordingly. These settings should mirror those of the bot.</p>

<p>That's the last of it! Enjoy!</p>
        </section>

        <footer>
          Pierc-postgresql is maintained by <a href="https://github.com/p2j">p2j</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-56709314-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>